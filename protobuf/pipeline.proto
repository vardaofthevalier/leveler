syntax = "proto3";

package pipelines;

import "integration.proto";

enum LogProducer {
	pipeline = 0;
	job = 1;
}

message Loggable {
	LogProducer kind = 1;
}

message Log {
	string message = 1;
}

message PipelineScmConfig {
	oneof scm {
		BitbucketAccessConfig bitbucket = 1;
		GithubAccessConfig github = 2;
	}
}

message PipelineStorageConfig {
	oneof storage {
		AWSConfig s3 = 1;
		NexusConfig nexus = 2;
	}
}

message S3Data {
	string src = 1;
	string dest = 2;
}

message NexusData {
	string src = 1;
	string dest = 3;
}

message PipelineInput {
	oneof input {
		S3Data s3 = 1;
		NexusData nexus = 2;
	}	
}

message PipelineOutput {
	oneof output {
		S3Data s3 = 1;
		NexusData nexus = 2;
	}
}

message PipelineAlertConfig {
	oneof config {
		SlackConfig slack = 1;
	}
}

message PipelineStep {
	string name = 1;
    string workdir = 2;
    string command = 3;
    string image = 4;
    repeated PipelineInput inputs = 5;
    repeated PipelineOutput outputs = 6;
    int32 timeout = 7;
    bool skip = 8;
    repeated string dependsOn = 9;
}

message BasicPipeline {
	repeated PipelineAlertConfig alerts = 1;
	repeated PipelineStorageConfig storage = 2;
	repeated PipelineScmConfig scm = 3;
	repeated PipelineStep steps = 4;
}

message CicdPipeline {
	repeated PipelineAlertConfig alerts = 1;
	repeated PipelineStorageConfig storage = 2;
	repeated PipelineScmConfig scm = 3;
	repeated PipelineStep quality = 4;
	repeated PipelineStep build = 5;
	repeated PipelineStep integration = 6;
	repeated PipelineStep promote = 7;
}

